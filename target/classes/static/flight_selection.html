<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flight Selection</title>
<link rel="stylesheet" href="/css/styles.css">
</head>
<body>
<h2>Available Flights</h2>
<div id="flightsList">Loading...</div>

<script>
function getQueryParams() {
    const params = new URLSearchParams(window.location.search);
    return {
        budget: params.get('budget'),
        from: params.get('from'),
        to: params.get('to'),
        date: params.get('date')
    };
}

async function fetchFlights() {
    const { budget, from, to, date } = getQueryParams();
    try {
        const res = await fetch(`/api/flights?budget=${budget}&from=${from}&to=${to}&date=${date}`);
        const flights = await res.json();
        const container = document.getElementById('flightsList');
        if (flights.length === 0) {
            container.innerHTML = "<p>No flights available within your budget.</p>";
            return;
        }
        container.innerHTML = flights.map(f => 
            `<div>
                <p>${f.airline} | ${f.from} → ${f.to} | Date: ${f.date} | Price: ₹${f.price}</p>
                <button>Book</button>
            </div>`
        ).join('');
    } catch (err) {
        console.error(err);
        document.getElementById('flightsList').innerHTML = "<p>Error fetching flights.</p>";
    }
}

fetchFlights();
</script>
</body>
</html>