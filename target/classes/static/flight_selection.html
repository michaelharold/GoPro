<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flight Selection</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body class="p-4">

<h2 class="mb-4">Select Your Flight</h2>

<div id="flights-container" class="row g-3"></div>

<script>
async function loadFlights() {
    const urlParams = new URLSearchParams(window.location.search);
    const travelBudget = urlParams.get('budget');

    try {
        const response = await fetch(`/api/flights?budget=${travelBudget}`);
        const flights = await response.json();
        const container = document.getElementById('flights-container');
        container.innerHTML = '';

        if (flights.length === 0) {
            container.innerHTML = `<p>No flights available within your budget.</p>`;
            return;
        }

        flights.forEach(flight => {
            const card = document.createElement('div');
            card.className = 'col-md-4';
            card.innerHTML = `
                <div class="card p-3">
                    <h5>${flight.airline}</h5>
                    <p>${flight.from} → ${flight.to}</p>
                    <p>Price: ₹${flight.price}</p>
                    <button class="btn btn-success w-100" onclick="bookFlight('${flight.airline}', '${flight.from}', '${flight.to}', ${flight.price})">Book</button>
                </div>
            `;
            container.appendChild(card);
        });
    } catch (err) {
        alert('Error fetching flights');
    }
}

async function bookFlight(airline, from, to, price) {
    const bookingData = {
        userId: 1,  // replace with actual logged-in user ID
        airline, from, to, price, date: new Date().toISOString().split('T')[0]
    };

    try {
        const res = await fetch('/api/book', {
            method: 'POST',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify(bookingData)
        });

        if (res.ok) {
            alert('Flight booked successfully!');
        } else {
            alert('Failed to book flight.');
        }
    } catch (err) {
        alert('Error booking flight.');
    }
}

// Load flights on page load
loadFlights();
</script>
</body>
</html>